{"version":3,"file":"cron-service.cjs.production.min.js","sources":["../src/db.ts","../src/index.ts"],"sourcesContent":["// db.ts\nimport mongoose from 'mongoose';\nrequire('dotenv').config();\n\n// MongoDB connection URI\nconst mongoURI = process.env.MONGODB_URL ? process.env.MONGODB_URL : '';\n\n// Function to connect to MongoDB\nexport const connectDB = async () => {\n\tmongoose.connect(mongoURI, { useNewUrlParser: true, useUnifiedTopology: true } as any)\n\t.then(() => {\n\t\tconsole.log('Connected to MongoDB');\n\t})\n\t.catch((err: Error) => {\n\t\tconsole.error('Error connecting to MongoDB:', err.message);\n\t});\n};\n\nexport default mongoose; // Export mongoose instance for use in other files\n","import cron from 'node-cron';\nimport mongoose, { connectDB } from \"./db\";\nconst Model = require('./models/data');\nconst whatsAppClient = require(\"@green-api/whatsapp-api-client\");\nrequire('dotenv').config();\n\nconst restAPI = whatsAppClient.restAPI({\n  idInstance: process.env.ID_INSTANCE || '',\n  apiTokenInstance: process.env.API_TOKEN_INSTANCE || ''\n});\n\nconst _main = async() => {\n\ttry {\n\t\tlet records = await Model.find()\n\t\tif(records && records.length > 0) {\n\t\t\tfor(let i = 0; i < records.length; i++){\n\t\t\t\tlet single_record = records[i]\n\t\t\t\tif(single_record.phone && single_record.date){\n\t\t\t\t\tif(new Date() > new Date(single_record.date)){\n\t\t\t\t\t\tconst differenceInMilliseconds = new Date().getTime() - new Date(single_record.date).getTime();\n\t\t\t\t\t\tconst millisecondsInDay = 1000 * 60 * 60 * 24; \n\t\t\t\t\t\tconst differenceInDays = Math.floor(differenceInMilliseconds / millisecondsInDay);\n\t\t\t\t\t\tif(differenceInDays >= 0 && differenceInDays <= 2){\n\t\t\t\t\t\t\tawait restAPI.message.sendMessage(single_record.phone, null, `Hey there! ðŸŒ¼ Flow Friend is Back with a friendly reminder: Your period is around the corner. It's been ${differenceInDays} days since your last one.\\n\\nJust reply with \"Got my period\" to update your date.`)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\tconsole.log(err)\n\t}\n}\n\ncron.schedule(`*/10 * * * * *`, async () => { //0 11 * * *\n  console.log(`running your task...`);\n  connectDB().then(() => {_main()})\n});"],"names":["require","config","mongoURI","process","env","MONGODB_URL","connectDB","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","mongoose","connect","useNewUrlParser","useUnifiedTopology","then","console","log","err","error","message","stop","apply","this","arguments","Model","whatsAppClient","restAPI","idInstance","ID_INSTANCE","apiTokenInstance","API_TOKEN_INSTANCE","_main","records","i","single_record","differenceInMilliseconds","differenceInDays","find","sent","length","phone","date","Date","getTime","Math","floor","sendMessage","t0","cron","schedule","_callee2","_context2"],"mappings":"6wNAEAA,QAAQ,UAAUC,SAGlB,IAAMC,EAAWC,QAAQC,IAAIC,YAAcF,QAAQC,IAAIC,YAAc,GAGxDC,EAAS,WAAA,IAAAC,EAAAC,EAAAC,IAAAC,MAAG,SAAAC,IAAA,OAAAF,IAAAG,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EACxBC,EAAQ,QAACC,QAAQf,EAAU,CAAEgB,iBAAiB,EAAMC,oBAAoB,IACvEC,MAAK,WACLC,QAAQC,IAAI,uBACb,IAAE,OACK,SAACC,GACPF,QAAQG,MAAM,+BAAgCD,EAAIE,QACnD,IAAG,KAAA,EAAA,IAAA,MAAA,OAAAZ,EAAAa,OAAA,GAAAf,EACH,KAAA,OAAA,WARqB,OAAAJ,EAAAoB,MAAAC,KAAAC,UAAA,CAAA,CAAA,GCNhBC,EAAQ9B,QAAQ,iBAChB+B,EAAiB/B,QAAQ,kCAC/BA,QAAQ,UAAUC,SAElB,IAAM+B,EAAUD,EAAeC,QAAQ,CACrCC,WAAY9B,QAAQC,IAAI8B,aAAe,GACvCC,iBAAkBhC,QAAQC,IAAIgC,oBAAsB,KAGhDC,EAAK,WAAA,IAAA9B,EAAAC,EAAAC,IAAAC,MAAG,SAAAC,IAAA,IAAA2B,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAjC,IAAAG,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OAAAF,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAEQe,EAAMa,OAAM,KAAA,EAArB,MAAPL,EAAOzB,EAAA+B,OACGN,EAAQO,OAAS,GAAC,CAAAhC,EAAAE,KAAA,GAAA,KAAA,CACvBwB,EAAI,EAAC,KAAA,EAAA,KAAEA,EAAID,EAAQO,QAAM,CAAAhC,EAAAE,KAAA,GAAA,KAAA,CACF,KAA1ByB,EAAgBF,EAAQC,IACXO,QAASN,EAAcO,KAAI,CAAAlC,EAAAE,KAAA,GAAA,KAAA,CAAA,KACxC,IAAIiC,KAAS,IAAIA,KAAKR,EAAcO,OAAK,CAAAlC,EAAAE,KAAA,GAAA,KAAA,CAGsC,GAF3E0B,GAA2B,IAAIO,MAAOC,UAAY,IAAID,KAAKR,EAAcO,MAAME,aAE/EP,EAAmBQ,KAAKC,MAAMV,EADV,SAEH,GAAKC,GAAoB,GAAC,CAAA7B,EAAAE,KAAA,GAAA,KAAA,CAAA,OAAAF,EAAAE,KAAA,GAC1CiB,EAAQP,QAAQ2B,YAAYZ,EAAcM,MAAO,KAAiHJ,2GAAAA,wFAAqG,KAAA,GAR9OH,IAAG1B,EAAAE,KAAA,EAAA,MAAA,KAAA,GAAAF,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,KAAA,GAAAD,EAAAwC,GAAAxC,EAAA,MAAA,GAevCQ,QAAQC,IAAGT,EAAAwC,IAAK,KAAA,GAAA,IAAA,MAAA,OAAAxC,EAAAa,OAAA,GAAAf,EAAA,KAAA,CAAA,CAAA,EAAA,KAEjB,KAAA,OAAA,WArBU,OAAAJ,EAAAoB,MAAAC,KAAAC,UAAA,CAAA,CAAA,GAuBXyB,EAAAA,QAAKC,SAAQ,iBAAA/C,EAAAC,IAAAC,MAAmB,SAAA8C,IAAA,OAAA/C,IAAAG,MAAA,SAAA6C,GAAA,OAAA,OAAAA,EAAA3C,KAAA2C,EAAA1C,MAAA,KAAA,EAC9BM,QAAQC,IAAG,wBACXhB,IAAYc,MAAK,WAAOiB,GAAO,IAAE,KAAA,EAAA,IAAA,MAAA,OAAAoB,EAAA/B,OAAA,GAAA8B,EAAA"}